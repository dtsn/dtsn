<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>JSON(P) Stacking</title>

        <link rel="icon" type="image/ico" href="/favicon.ico" />
        <link rel="stylesheet" href="/style.css" type="text/css" media="screen" title="main screen css" charset="utf-8">
    
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:url" content="http://dtsn.me/2009/12/06/jsonp-stacking.html" />
        <meta name="twitter:title" content="JSON(P) Stacking" />
        <meta name="twitter:site" content="DTSN - A Front End Developer &amp; Data Artist at DataSift" />

        <!-- D3 -->
        <script type="text/javascript" src="/scripts/d3.js"></script>

        <script type="text/javascript" src="//use.typekit.net/fjk3dnb.js"></script>
		<script type="text/javascript">try{Typekit.load();}catch(e){}</script>


    </head>
    <body>

    	<header>
    		<h1><a href="/" title="Home">dtsn</a></h1>
    	</header>

<section class="post">

	<h2>JSON(P) Stacking</h2>
	<h4 class="date">06 December 2009</h4>

	<hr />

	<p>JSONP was proposed as grabbing data from external domains avoiding the cross script scripting limitations (see this <a href="http://ajaxian.com/archives/jsonp-json-with-padding">Ajaxian article</a> for more information). It requires a call to an external API where you specificy the a callback function, you do this through the use of script tag. For example:</p>  <pre class="html" name="code">&lt;script type=&quot;text/javascript&quot; src=&quot;http://yourdomain.com/api?callback=myfunction&quot;&gt;&lt;/script&gt;</pre>

<p>When the script tag has been loaded your function would be called with the JSON data, like so.</p>

<pre class="js" name="code">myfunction(‘some JSON data’);</pre>

<p>However you become reliant on that external service to always be available, if for any reason that service goes down you wouldn’t get any data and your page would be likely to hang.</p>

<p><strong>Therefore I propose a system of JSONP stacking, quite simply you stack up your JSON requests if you don’t receive a response in a set time it will stop the request.</strong></p>

<p>This can be easily achieved by having the following function:</p>

<pre class="js" name="code">// callback function
var _c = false;
// success flag
var _s = false;

function JSONPStacking(url, callback) {
	// create the element
	var script = document.createElement('script');
	// set the source
	script.src = url + '&amp;callback=callback';
	// render the element
	document.appendChild(script);
	// start the counter, this one last for 5 seconds
	setTimeout(function() {
		if (!_s) {
			// remove the element
			document.body.removeChild(script);
		}
	}, 5000);
}

function callback(data) {
	// say the data has been received
	_s = true;
	// call the callback with the data
	_c(data);
}</pre>

<p>Basically what we are doing here is to create a normal JSONP request by creating a script tag and loading it into the body. However we are overriding the standard callback function with our own one, <em>callback. </em>When the request succeeds this will call that function with the data and in turn we call our success function. If 5 seconds have past the timeout will trigger, see if the success flag has been set if not it will remove the element from the DOM thereby stopping the request.</p>

<p>That's it, it is a really simple principle but will hopefully stop your site from hanging on long request, such as for the Twitter widget. It will also make your widgets that you build a lot more stable and won't overload your site.</p>


</section>


	
	<footer>
		Built using <a href="https://github.com/mojombo/jekyll">Jekyll</a>, fork this on <a href="https://github.com/dtsn/dtsn">Github</a>
	</footer>

	<script type="text/javascript" src="/scripts/dtsn.js"></script>

	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-37892446-1']);
		_gaq.push(['_trackPageview']);

		(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>

	</body>
</html>